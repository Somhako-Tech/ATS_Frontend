/* eslint-disable react-hooks/rules-of-hooks */
import Head from "next/head"
import Image from "next/image"
import Link from "next/link"
import React, { useEffect, useState } from "react"
import Masonry, {ResponsiveMasonry} from "react-responsive-masonry"
import { useCarrierStore } from "@/utils/code"
import { axiosInstance } from "@/pages/api/axiosApi"
import Button from "@/components/button";
import moment from "moment"
import { useRouter } from "next/router"

export default function cancareer() {
    const router = useRouter();

    const cname = useCarrierStore((state) => state.cname)
    const setcname = useCarrierStore((state) => state.setcname)

    const cid = useCarrierStore((state) => state.cid)
    const setcid = useCarrierStore((state) => state.setcid)
    const jid = useCarrierStore((state) => state.jid)
    const setjid = useCarrierStore((state) => state.setjid)
    const jdata = useCarrierStore((state) => state.jdata)
    const setjdata = useCarrierStore((state) => state.setjdata)
    const orgdetail = useCarrierStore((state) => state.orgdetail)
    const setorgdetail = useCarrierStore((state) => state.setorgdetail)

    useEffect(() => {
        if(cname=="" || cname != window.location.href.toString().split("/").pop()){
            setcname(window.location.href.toString().split("/").pop())
        }
    }, [cname, setcname])


	async function getcid(cname: any) {
		await axiosInstance
        .get(`/organization/get/organisationprofilecid/carrier/${cname}/`)
        .then((res) => {
			setcid(res.data["oprofiledata"][0]["unique_id"])
        })
	}

	async function loadOrgDetail(carrierID: any) {
		await axiosInstance
        .get(`/organization/get/organisationprofile/carrier/${carrierID}/`)
        .then((res) => {
			setorgdetail(res.data)
        })
	}

    useEffect(()=>{
        if(cid && Object.keys(orgdetail).length === 0){
            loadOrgDetail(cid)
        }
    },[cid,orgdetail])

    
    useEffect(()=>{
        if(cname && cid == ""){
            getcid(cname)
        }
    },[cname,cid])
    
    return (
        <>
            <Head>
                <title>Career</title>
                <meta name="description" content="Generated by create next app" />
            </Head>
            <main className="py-8">
            
					{orgdetail && orgdetail['OrgProfile'] && 
					
					orgdetail['OrgProfile'].map((data,i)=>(
						<>
                        <div className="w-full max-w-[1200px] mx-auto px-4" key={i}>
                            <Image src={`http://127.0.0.1:8000${data['banner']}`} alt="Banner" width={1200} height={200} className="rounded-large mb-6 mx-auto max-h-[200px] object-cover" />
                            <div className="w-full max-w-[1100px] mx-auto px-4">
                                <div className="bg-white dark:bg-gray-800 rounded-normal py-4 px-8 mb-6">
                                    <div className="flex flex-wrap mb-3 border p-4 pb-0 rounded-normal">
                                    {orgdetail['Founder'].map((data,i)=>(
                                        <div className="w-full md:max-w-[calc(100%/3)] lg:max-w-[calc(100%/4)] xl:max-w-[calc(100%/5)] pr-4 mb-3 text-center" key={i}>
                                            <Image src={`http://127.0.0.1:8000${data['image']}`} alt="User" width={80} height={80} className="h-[80px] rounded-full object-cover mb-2 mx-auto" />
                                            <p className="font-bold text-sm mb-1">{data['name']}</p>
                                            <p className="text-sm text-darkGray">{data['designation']}</p>
                                        </div>
                                    ))}
                                    </div>
                                    {data['org_Url'] && data['org_Url']!= '' && <p className="mb-3">
                                        <Link href={`${data['org_Url']}`} target="_blank" className="text-primary dark:text-white hover:underline"><i className="fa-solid fa-globe mr-2"></i> {data['org_Url']}</Link>
                                    </p>
                                    }
                                    <ul className="mb-6 flex flex-wrap items-center list-disc list-inside text-darkGray dark:text-white font-semibold">
                                        {data['company_Size'] && data['company_Size']!= '' && <li className="mr-3">
                                        {data['company_Size']} Employees 
                                        </li>}
                                        {data['headquarter_Location'] && data['headquarter_Location']!= '' &&<li className="mr-3">
                                        {data['headquarter_Location']}
                                        </li>}
                                        {data['funding_Details'] && data['funding_Details']!= '' && <li className="mr-3">
                                        {data['funding_Details']}
                                        </li>}
                                    </ul>
                                    <hr className="mb-6" />
                                    {data['about_org'] && data['about_org']!= '' && <article className="mb-6">
                                        {data['about_org']}
                                    </article>}
                                    <hr className="mb-6" />
                                    {data['organization_Benefits'] && data['organization_Benefits']!= '' && <div className="mb-6">
                                        <h2 className="font-bold text-lg mb-3">Benefits</h2>
                                        <p>{data['organization_Benefits']}</p>
                                        {/* <ul className="mb-6 list-disc list-inside text-darkGray dark:text-white font-semibold">
                                            <li className="mr-3">
                                            Medical Insurance
                                            </li>
                                            <li className="mr-3">
                                            Quarterly Bonus
                                            </li>
                                            <li className="mr-3">
                                            Meals
                                            </li>
                                        </ul> */}
                                    </div>
                                    }
                                    <hr className="mb-6" />
                                    { orgdetail['Gallery'] && 
                                    <div>
                                        <h2 className="font-bold text-lg mb-3">Work Place Culture</h2>
                                        <div className="border rounded-large p-6">
                                            <ResponsiveMasonry
                                                columnsCountBreakPoints={{350: 1, 750: 2, 900: 3}}
                                            >
                                                <Masonry>
                                                    {orgdetail['Gallery'].map((data, i) => (
                                                        <img
                                                        src={`http://127.0.0.1:8000${data.image}`}
                                                        alt="Office"
                                                        className="rounded-normal w-full p-2"
                                                        key={i}
                                                        />
                                                    ))}
                                                </Masonry>
                                            </ResponsiveMasonry>
                                        </div>
                                    </div>}
                                </div>
                                { orgdetail['Job'] && 
                                    <div>
                                        <h2 className="font-bold text-xl mb-3">Similar Jobs</h2>
                                        <div className="flex flex-wrap mx-[-7px]">
                                        {orgdetail['Job'].slice(0, 2).map((data,i)=>(
                                            <div className="w-full md:max-w-[50%] lg:max-w-[calc(100%/3)] px-[7px] mb-[15px]" key={i}>
                                                <div className="h-full bg-white dark:bg-gray-800 rounded-[10px] shadow-normal p-5">
                                                    <h4 className="font-bold text-lg mb-3">{data['job_title']}</h4>
                                                    <ul className="mb-3 flex flex-wrap items-center text-[12px] text-darkGray dark:text-white font-semibold">
                                                        <li className="mr-8">
                                                            <i className="fa-solid fa-location-dot mr-2"></i>
                                                            {data['worktype'] ? data['worktype'] : <>N/A</>}
                                                        </li>
                                                        <li className="mr-8">
                                                            <i className="fa-regular fa-clock mr-2"></i>
                                                            {data['employment_type'] ? data['employment_type'] : <>N/A</>}
                                                        </li>
                                                        <li className="mr-8">
                                                            <i className="fa-solid fa-dollar-sign mr-2"></i>
                                                            {data['currency'] ? data['currency'] : <>N/A</>}
                                                        </li>
                                                    </ul>
                                                    <div className="flex flex-wrap justify-between items-center">
                                                        <div className="mr-4">
                                                            <Button btnStyle="sm" label="View" loader={false} 
                                                            btnType="button" handleClick={()=>{
                                                                setjid(data['refid'])
                                                                setjdata(data)
                                                                router.push(`/organization/${cname}/job-detail`)
                                                            }}
                                                            />
                                                        </div>
                                                        <p className="font-bold text-darkGray dark:text-white text-[12px]">{moment(data['publish_date']).fromNow()}</p>
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                        </div>
                                        <Button btnStyle="sm" label="View All Job" loader={false} btnType="button" handleClick={()=>{
                                            router.push(`/organization/${cname}/search-jobs`)
                                        }}/>
                                    </div>
                                }
                            </div>
                        </div>





                        </>
						
					))}

            </main>
        </>
    )
}
